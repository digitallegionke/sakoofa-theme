{% liquid
  assign main_menu = linklists[section.settings.menu]
%}

<header class="header {% if section.settings.sticky_header %}header--sticky{% endif %}" data-header>
  <div class="container">
    <div class="header__wrapper">
      <!-- Logo -->
      <div class="header__logo">
        {% if section.settings.logo != blank %}
          <a href="{{ routes.root_url }}">
            {%- assign image_size = section.settings.logo_width | append: 'x' -%}
            <img src="{{ section.settings.logo | img_url: image_size }}"
                 alt="{{ section.settings.logo.alt | default: shop.name }}"
                 width="{{ section.settings.logo_width }}"
                 height="{{ section.settings.logo_width | divided_by: section.settings.logo.aspect_ratio | round }}"
                 loading="eager">
          </a>
        {% else %}
          <a href="{{ routes.root_url }}" class="header__logo-text">{{ shop.name }}</a>
        {% endif %}
      </div>

      <!-- Navigation -->
      <nav class="header__nav" role="navigation">
        {% if main_menu.links.size > 0 %}
          <ul class="header__menu">
            {% for link in main_menu.links %}
              <li class="header__menu-item{% if link.links.size > 0 %} has-submenu{% endif %}">
                <a href="{{ link.url }}" {% if link.current %}aria-current="page"{% endif %}>
                  {{ link.title }}
                </a>
                {% if link.links.size > 0 %}
                  <ul class="submenu">
                    {% for childlink in link.links %}
                      <li>
                        <a href="{{ childlink.url }}" {% if childlink.current %}aria-current="page"{% endif %}>
                          {{ childlink.title }}
                        </a>
                      </li>
                    {% endfor %}
                  </ul>
                {% endif %}
              </li>
            {% endfor %}
          </ul>
        {% endif %}
      </nav>

      <!-- Header Actions -->
      <div class="header__actions">
        {% if section.settings.show_search %}
          <button type="button" class="header__search-toggle" aria-label="{{ 'general.search.search' | t }}" data-search-toggle>
            {% render 'icon-search' %}
          </button>
        {% endif %}

        <a href="{{ routes.cart_url }}" class="header__cart">
          {% render 'icon-cart' %}
          <span class="cart-count" data-cart-count>
            {{ cart.item_count }}
          </span>
        </a>
      </div>
    </div>
  </div>

  {% if section.settings.show_search %}
    <div class="search-modal" data-search-modal>
      <div class="container">
        <form action="{{ routes.search_url }}" method="get" role="search" class="search-form">
          <input type="search"
                 name="q"
                 placeholder="{{ 'general.search.placeholder' | t }}"
                 aria-label="{{ 'general.search.placeholder' | t }}">
          <button type="submit">{{ 'general.search.submit' | t }}</button>
        </form>
      </div>
    </div>
  {% endif %}
</header>

{% schema %}
{
  "name": "Header",
  "settings": [
    {
      "type": "image_picker",
      "id": "logo",
      "label": "Logo"
    },
    {
      "type": "range",
      "id": "logo_width",
      "min": 50,
      "max": 300,
      "step": 10,
      "default": 100,
      "unit": "px",
      "label": "Logo width"
    },
    {
      "type": "link_list",
      "id": "menu",
      "label": "Menu",
      "default": "main-menu"
    },
    {
      "type": "checkbox",
      "id": "sticky_header",
      "label": "Sticky header",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_search",
      "label": "Show search",
      "default": true
    }
  ],
  "presets": [
    {
      "name": "Header",
      "category": "Header"
    }
  ]
}
{% endschema %}

{% stylesheet %}
.header {
  padding: 1rem 0;
  background: var(--color-background);
  border-bottom: 1px solid var(--color-border);
}

.header--sticky {
  position: sticky;
  top: 0;
  z-index: 100;
}

.header__wrapper {
  display: flex;
  align-items: center;
  justify-content: space-between;
}

.header__logo img {
  display: block;
  max-width: 100%;
  height: auto;
}

.header__logo-text {
  font-size: 1.5rem;
  font-weight: bold;
  text-decoration: none;
  color: var(--color-text);
}

.header__menu {
  display: flex;
  gap: 1.5rem;
  list-style: none;
  margin: 0;
  padding: 0;
}

.header__menu-item a {
  text-decoration: none;
  color: var(--color-text);
}

.header__actions {
  display: flex;
  align-items: center;
  gap: 1rem;
}

.header__search-toggle,
.header__cart {
  background: none;
  border: none;
  padding: 0.5rem;
  cursor: pointer;
  display: flex;
  align-items: center;
}

.cart-count {
  background: var(--color-accent);
  color: var(--color-background);
  border-radius: 50%;
  padding: 0.25rem 0.5rem;
  font-size: 0.75rem;
  margin-left: 0.25rem;
}

.search-modal {
  display: none;
  position: absolute;
  top: 100%;
  left: 0;
  right: 0;
  background: var(--color-background);
  padding: 1rem 0;
  border-top: 1px solid var(--color-border);
}

.search-modal.is-active {
  display: block;
}

.search-form {
  display: flex;
  gap: 1rem;
  max-width: 600px;
  margin: 0 auto;
}

.search-form input[type="search"] {
  flex: 1;
  padding: 0.5rem;
  border: 1px solid var(--color-border);
  border-radius: 4px;
}

.search-form button {
  padding: 0.5rem 1rem;
  background: var(--color-accent);
  color: var(--color-background);
  border: none;
  border-radius: 4px;
  cursor: pointer;
}

@media screen and (max-width: 768px) {
  .header__nav {
    display: none;
  }
}
{% endstylesheet %}

{% javascript %}
document.addEventListener('DOMContentLoaded', function() {
  const searchToggle = document.querySelector('[data-search-toggle]');
  const searchModal = document.querySelector('[data-search-modal]');

  if (searchToggle && searchModal) {
    searchToggle.addEventListener('click', function() {
      searchModal.classList.toggle('is-active');
    });
  }
});
{% endjavascript %}